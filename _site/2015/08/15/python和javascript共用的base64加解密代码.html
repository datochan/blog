<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<title>python和javascript共用的base64加解密代码 | 陈大头的博客</title>
<meta name="author" content="陈俊州">
<meta http-equiv="Content-Language" content="zh-CN" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">




<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/style.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/font-awesome.min.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/responsiveslides.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/leonhere.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/prettify/prettify.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>

<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/font-awesome-ie7.min.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<![endif]-->

</head>
<body>
<header class="site-header" role="banner">
	<div class="header fixed">
		<div class="top-box">
			<div class="logo">
				<a href="http://localhost:4000" title="莲花乡-十里屯">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/logo.png" alt="莲花乡-十里屯">
				</a>
			</div>
			<div class="btn"><i class="icon-th-large"></i></div>		
			<nav class="nav" role="navigation">
				<div class="menu">
					<ul>
						<li id="nvabar-index"><a href="http://localhost:4000">首页</a></li>
						<li id="navbar-technology"><a href="http://ui66.com/category-2.html">技术文章</a></li>
						<li id="navbar-life"><a href="http://ui66.com/category-4.html">生活日记</a></li>
						<li id="navbar-about"><a href="http://ui66.com/7.html">关于我</a></li>
					</ul>
				</div>
			</nav>
		</div>
<div class="clear"></div>
</header>
<div class="container">
<!-- 文章列表 或者 文章内容 -->




<div class="breadcrumb">	
	<i class="icon-home"></i> 
	<a href="http://localhost:4000" title="陈大头的博客">首页</a> »
	<a href="http://datochan.me/category-2.html" title="查看 技术文章 中的全部文章">技术文章</a> »
		
</div>

<main class="main" role="main">
	<div class="clear"></div>
	<article class="post cate2  auth1">
		<h1>python和javascript共用的base64加解密代码</h1>
		<div class="postmeta article-meta">
			<span><i class="icon-calendar"></i> 日期：2015-08-15 </span>
			<span><i class="icon-book"></i> 栏目：<a href="http://datochan.me/category-2.html" title="技术文章" target="_blank">技术文章</a></span>
	<!-- 		<span><i class="icon-fire"></i> 浏览：219次 </span>
			<span><i class="icon-comments"></i> 评论：0条</span> -->
		</div>
		<div class="entry">
			<p>最近在OpenEDX中开发了个新的组件，其中需要支持上传功能。由于全都是异步操作，而一些现有的文件上传的库都失效不可用。所以想自己将文件编码成base64，扔到服务端，服务端接收解码保存，以此来实现文件上传的功能。<br />
之前在javascript中加解密部分一直喜欢用CryptoJS库。</p>

<p>结果发现此库对数据Base64编码后，python的base64库解密不出来。后来更换了<a href="&quot;https://github.com/dankogai/js-base64&quot;">js-base64</a> 这个库，还是不行，于是自己用coffeescript写了一个。这里存档，以备后用。</p>

<pre><code class="language-coffeescript">class CSTBase64
    @_keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
    @encode = (s) -&gt;
        res = []
        leftover = s.length % 3
        end = s.length - leftover
        for i in [0 .. end] by 3
            c2 = s.charCodeAt(i);
            c1 = s.charCodeAt(i+1);
            c0 = s.charCodeAt(i+2);
            res.push(@_keyStr[(c2 &gt;&gt; 2) &amp; 0x3f])
            res.push(@_keyStr[((c2 &amp; 0x3) &lt;&lt; 4) | ((c1 &gt;&gt; 4) &amp; 0x0f)])
            res.push(@_keyStr[((c1 &amp; 0x0f) &lt;&lt; 2) | ((c0 &gt;&gt; 6) &amp; 0x03)])
            res.push(@_keyStr[c0 &amp; 0x3f])

        i += 3
        if leftover == 1
            c2 = s.charCodeAt(i);
            res.push(@_keyStr[(c2 &gt;&gt; 2) &amp; 0x3f])
            res.push(@_keyStr[(c2 &amp; 0x3) &lt;&lt; 4])
            res.push(@_keyStr[-1..])
            res.push(@_keyStr[-1..])

        else if leftover == 2
            c2 = s.charCodeAt(i);
            c1 = s.charCodeAt(i+1);
            res.push(@_keyStr[(c2 &gt;&gt; 2) &amp; 0x3f])
            res.push(@_keyStr[((c2 &amp; 0x3) &lt;&lt; 4) | ((c1 &gt;&gt; 4) &amp; 0x0f)])
            res.push(@_keyStr[(c1 &amp; 0x0f) &lt;&lt; 2])
            res.push(@_keyStr[-1..])

        return res.join("")


    @decode = (s)-&gt;
        res = []
        end = len(s)
        if s[-1] == @_keyStr[-1..]
            end -= 4

        for i in [0 .. end] by 4
            c3 = @_keyStr.indexOf(s[i])
            c2 = @_keyStr.indexOf(s[i+1])
            c1 = @_keyStr.indexOf(s[i+2])
            c0 = @_keyStr.indexOf(s[i+3])

            res.push(String.fromCharCode(((c3 &lt;&lt; 2)) | ((c2 &gt;&gt; 4) &amp; 0x03)))
            res.push(String.fromCharCode(((c2 &amp; 0x0f) &lt;&lt; 4) | ((c1 &gt;&gt; 2) &amp; 0x0f)))
            res.push(String.fromCharCode(((c1 &amp; 0x03) &lt;&lt; 6) | (c0 &amp; 0x03f)))

        if end &lt; len(s)
            if s[-2] == @_keyStr[-1..]
                c3 = @_keyStr.indexOf(s[end])
                c2 = @_keyStr.indexOf(s[end+1])
                res.push(String.fromCharCode(((c3 &lt;&lt; 2)) | ((c2 &gt;&gt; 4) &amp; 0x03)))
            else
                c3 = @_keyStr.indexOf(s[end])
                c2 = @_keyStr.indexOf(s[end+1])
                c1 = @_keyStr.indexOf(s[end+2])

                res.push(String.fromCharCode(((c3 &lt;&lt; 2)) | ((c2 &gt;&gt; 4) &amp; 0x03)))
                res.push(String.fromCharCode(((c2 &amp; 0x0f) &lt;&lt; 4) | ((c1 &gt;&gt; 2) &amp; 0x0f)))
        return res.join("")
</code></pre>

		</div>
		<div class="tags">
			<span><i class="icon-tags"></i> 标签：</span><a href="http://datochan.me/tags-1.html" title="web">web</a><a href="http://datochan.me/tags-1.html" title="edx">edx</a>
		</div>
		<div class="post-nav">
			

			
			<div class="nav-right">
				<span>下一篇：<i class="icon-chevron-right"></i></span>
				<a href="/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" target="_blank" title="xblock-sdk学习笔记之制作studio界面">xblock-sdk学习笔记之制作studio界面</a>
			</div>
			
		</div>
		<div class="post-copyright">
			<p>内容版权声明：除非注明，否则皆为本站原创文章。</p>
			<p>转载注明出处：<a href="http://localhost:4000/2015/08/15/python%E5%92%8Cjavascript%E5%85%B1%E7%94%A8%E7%9A%84base64%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%BB%A3%E7%A0%81.html" title="python和javascript共用的base64加解密代码" target="_blank">python和javascript共用的base64加解密代码(http://localhost:4000/2015/08/15/python%E5%92%8Cjavascript%E5%85%B1%E7%94%A8%E7%9A%84base64%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%BB%A3%E7%A0%81.html)</a></p>
		</div>	

	<!-- 多说评论框 start -->
	<div id="comment" class="ds-thread commentsform" data-thread-key="/2015/08/15/python和javascript共用的base64加解密代码" data-title="python和javascript共用的base64加解密代码" data-url="/2015/08/15/python%E5%92%8Cjavascript%E5%85%B1%E7%94%A8%E7%9A%84base64%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%BB%A3%E7%A0%81.html"></div>
	<!-- 多说评论框 end -->
	</article>				
</main>

<aside class="sidebar">	
<section class="widget" id="divSearchPanel">
	<h3><i class="icon-search"></i> 搜索</h3>
	<div>
		<form name="search" method="post" action="http://ui66.com/zb_system/cmd.php?act=search">
			<input type="text" name="q" size="11"> <input type="submit" value="搜索">
		</form>
	</div>
</section>
<section class="widget" id="divRelated">
	<h3><i class="icon-bookmark"></i> 相关推荐</h3>
	<ul class="hot-post">
	
		
		<li>
			<div class="thumb">
				<a href="http://localhost:4000/2015/10/25/%E5%9C%A8xblock-sdk%E4%B8%AD%E4%BD%BF%E7%94%A8makotemplates.html" title="sdk中使用makotemplates">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/category/edx.jpg" alt="sdk中使用makotemplates">
				</a>
			</div>
			<div class="hot-title">
				<a href="http://localhost:4000/2015/10/25/%E5%9C%A8xblock-sdk%E4%B8%AD%E4%BD%BF%E7%94%A8makotemplates.html" title="sdk中使用makotemplates">sdk中使用makotemplates</a>
			</div>
			<div class="hot-time"><i class="icon-time"></i> 2015-10-25</div>
		</li>
	
		
		<li>
			<div class="thumb">
				<a href="http://localhost:4000/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" title="sdk学习笔记之制作studio界面">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/category/edx.jpg" alt="sdk学习笔记之制作studio界面">
				</a>
			</div>
			<div class="hot-title">
				<a href="http://localhost:4000/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" title="sdk学习笔记之制作studio界面">sdk学习笔记之制作studio界面</a>
			</div>
			<div class="hot-time"><i class="icon-time"></i> 2015-08-28</div>
		</li>
	
	</ul>
</section>

<section class="widget" id="scroll">
	<h3><i class="icon-th-list"></i>文章目录</h3>
	<ul class="news-list">
	
	</ul>
</section>

</aside>

</div>
<footer class="footer">
	<div class="foot">
	<p>
		<i class="fa fa-copyright"></i> 2015 <a href="http://datochan.me/">DatoChan's Blog</a>. Theme designed by <a href="http://www.boke8.net/zblog-php-start.html" target="_blank">boke8.net</a> with <a href="https://github.com/mojombo/jekyll/" target="_blank">Jekyll</a> and <a href="http://fortawesome.github.com/Font-Awesome/" target="_blank">Font Awesome</a>.
	</p>
</div>
</footer>
<div class="backtop">
	<a title="反回顶部"><i class="icon-chevron-up"></i></a>
</div>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/responsiveslides.min.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/leonhere.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/jquery.lazyload.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/prettify/prettify.js"></script>

<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"datochan"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
<!-- 多说公共JS代码 end -->

<script type="text/javascript">

$(document).ready(function(){
	$(".post .thumb img,.entry img").lazyload({
  	  	placeholder : "http://7xnsgl.com1.z0.glb.clouddn.com/public/images/grey.gif", 
  	 	effect      : "fadeIn"
	});

	$("#slider").responsiveSlides({
		auto: true,
		pager: true,
		nav: false,
		speed: 500,
		timeout: 5000,
		namespace: "centered-btns"
	});

	// 点击文章目录时让滚动条缓慢滚动
	$("#scroll").on("click", "a", function() {
	    $('html, body').animate({
	        scrollTop: $( $.attr(this, 'href') ).offset().top - 120
	    }, 500);
	    return false;
	});

	// 将目录移动到目录栏
	$("#scroll ul").html($("#markdown-toc").html());
	$("#markdown-toc").remove();

	// 启用代码高亮
    $("pre").addClass("prettyprint");
    prettyPrint();
});

</script>

</body>
</html>