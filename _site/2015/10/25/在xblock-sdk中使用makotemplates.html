<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<title>2015-10-25-在xblock-sdk中使用makotemplates | 陈大头的博客</title>
<meta name="author" content="陈俊州">
<meta http-equiv="Content-Language" content="zh-CN" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">




<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/style.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/font-awesome.min.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/responsiveslides.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/leonhere.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/prettify/prettify.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>

<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="http://7xnsgl.com1.z0.glb.clouddn.com/public/css/font-awesome-ie7.min.css" media="screen"http://7xnsgl.com1.z0.glb.clouddn.com/>
<![endif]-->

</head>
<body>
<header class="site-header" role="banner">
	<div class="header fixed">
		<div class="top-box">
			<div class="logo">
				<a href="http://localhost:4000" title="莲花乡-十里屯">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/logo.png" alt="莲花乡-十里屯">
				</a>
			</div>
			<div class="btn"><i class="icon-th-large"></i></div>		
			<nav class="nav" role="navigation">
				<div class="menu">
					<ul>
						<li id="nvabar-index"><a href="http://localhost:4000">首页</a></li>
						<li id="navbar-technology"><a href="http://ui66.com/category-2.html">技术文章</a></li>
						<li id="navbar-life"><a href="http://ui66.com/category-4.html">生活日记</a></li>
						<li id="navbar-about"><a href="http://ui66.com/7.html">关于我</a></li>
					</ul>
				</div>
			</nav>
		</div>
<div class="clear"></div>
</header>
<div class="container">
<!-- 文章列表 或者 文章内容 -->




<div class="breadcrumb">	
	<i class="icon-home"></i> 
	<a href="http://localhost:4000" title="陈大头的博客">首页</a> »
	<a href="http://datochan.me/category-2.html" title="查看 技术文章 中的全部文章">技术文章</a> »
		
</div>

<main class="main" role="main">
	<div class="clear"></div>
	<article class="post cate2  auth1">
		<h1>2015-10-25-在xblock-sdk中使用makotemplates</h1>
		<div class="postmeta article-meta">
			<span><i class="icon-calendar"></i> 日期：2015-10-25 </span>
			<span><i class="icon-book"></i> 栏目：<a href="http://datochan.me/category-2.html" title="技术文章" target="_blank">技术文章</a></span>
	<!-- 		<span><i class="icon-fire"></i> 浏览：219次 </span>
			<span><i class="icon-comments"></i> 评论：0条</span> -->
		</div>
		<div class="entry">
			<p>在xblock-sdk中编写插件时，代码中没有办法使用中文。初次遇到这个问题时并没有往心里去，自以为代码中用英文等最后通过i18n_tool翻译成中文也就是了。<br />
今天在一份试卷中插入了两个主观题，由于每个xblock都会将相应的js代码引入到当前页面中，结果可想而知: js代码函数重定义。<br />
用String.format方式对js代码进行替换关键字无果(js中’{}’是String.format的关键字)，没有办法只能将js代码以字符串的形式写在了python文件中，弄的心里好一顿不舒服，总觉得要是能将mako templates放到xblock中使用就完美了。<br />
研究了下xblock-sdk的API，发现 pkg-resources 只是简单的读取字符串操作。mako templates只需要render一下就可以将mako模板变成相应的字符串了。所以在xblock中使用mako应该不需要折腾直接用mako代替pkg-resources即可。直接上代码:</p>

<pre><code>from mako.template import Template

# 载入模板文件
mako_template = Template(filename=os.path.dirname(__file__)+"/static/html/subjective_view.html")
html_str = mako_template.render_unicode(module_title=module_title,
                                        question= self.question,
                                        module_weight=self.weight,
                                        answer=self.student_answers,
                                        module_id=self.location.block_id)

frag = Fragment(html_str)
# 载入css文件
mako_template = Template(filename=os.path.dirname(__file__)+"/static/css/subjective.css")
frag.add_css(mako_template.render_unicode())

# 载入js脚本, 传递参数也不仅限于html模板。
mako_template = Template(filename=os.path.dirname(__file__)+"/static/js/src/subjective_student.js")
frag.add_javascript(mako_template.render_unicode(xblock_id=self.location.block_id))
</code></pre>

<p>如此导入的html、css、js，中文可以随便写，变量也可以随便替换了。如下代码:</p>

<pre><code>// 这里可以写中文注释
function SubjectiveEditBlock_${xblock_id}(runtime, element){
    // 绑定按钮事件
    $("#${xblock_id} button:submit").bind('click', function(){
        $("#${xblock_id} button:submit+p").css("display", "none");
        var handlerUrl = runtime.handlerUrl(element, 'student_submit');
    ...
</code></pre>

<p>最后不要忘记在你的模板中加入 <code>## coding: utf-8</code> , 到这里引入mako就完成了。</p>

		</div>
		<div class="tags">
			<span><i class="icon-tags"></i> 标签：</span><a href="http://datochan.me/tags-1.html" title="edx">edx</a><a href="http://datochan.me/tags-1.html" title="studio">studio</a>
		</div>
		<div class="post-nav">
			
			<div class="nav-left">
				<span><i class="icon-chevron-left"></i> 上一篇：</span>
				<a href="/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" target="_blank" title="xblock-sdk学习笔记之制作studio界面">xblock-sdk学习笔记之制作studio界面</a>
			</div>
			

			
		</div>
		<div class="post-copyright">
			<p>内容版权声明：除非注明，否则皆为本站原创文章。</p>
			<p>转载注明出处：<a href="http://localhost:4000/2015/10/25/%E5%9C%A8xblock-sdk%E4%B8%AD%E4%BD%BF%E7%94%A8makotemplates.html" title="2015-10-25-在xblock-sdk中使用makotemplates" target="_blank">2015-10-25-在xblock-sdk中使用makotemplates(http://localhost:4000/2015/10/25/%E5%9C%A8xblock-sdk%E4%B8%AD%E4%BD%BF%E7%94%A8makotemplates.html)</a></p>
		</div>	

	<!-- 多说评论框 start -->
	<div id="comment" class="ds-thread commentsform" data-thread-key="/2015/10/25/在xblock-sdk中使用makotemplates" data-title="sdk中使用makotemplates" data-url="/2015/10/25/%E5%9C%A8xblock-sdk%E4%B8%AD%E4%BD%BF%E7%94%A8makotemplates.html"></div>
	<!-- 多说评论框 end -->
	</article>				
</main>

<aside class="sidebar">	
<section class="widget" id="divSearchPanel">
	<h3><i class="icon-search"></i> 搜索</h3>
	<div>
		<form name="search" method="post" action="http://ui66.com/zb_system/cmd.php?act=search">
			<input type="text" name="q" size="11"> <input type="submit" value="搜索">
		</form>
	</div>
</section>
<section class="widget" id="divRelated">
	<h3><i class="icon-bookmark"></i> 相关推荐</h3>
	<ul class="hot-post">
	
		
		<li>
			<div class="thumb">
				<a href="http://localhost:4000/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" title="sdk学习笔记之制作studio界面">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/category/edx.jpg" alt="sdk学习笔记之制作studio界面">
				</a>
			</div>
			<div class="hot-title">
				<a href="http://localhost:4000/2015/08/28/xblock-sdk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%B6%E4%BD%9Cstudio%E7%95%8C%E9%9D%A2.html" title="sdk学习笔记之制作studio界面">sdk学习笔记之制作studio界面</a>
			</div>
			<div class="hot-time"><i class="icon-time"></i> 2015-08-28</div>
		</li>
	
		
		<li>
			<div class="thumb">
				<a href="http://localhost:4000/2015/08/15/python%E5%92%8Cjavascript%E5%85%B1%E7%94%A8%E7%9A%84base64%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%BB%A3%E7%A0%81.html" title="python和javascript共用的base64加解密代码">
					<img src="http://7xnsgl.com1.z0.glb.clouddn.com/public/images/category/web.png" alt="python和javascript共用的base64加解密代码">
				</a>
			</div>
			<div class="hot-title">
				<a href="http://localhost:4000/2015/08/15/python%E5%92%8Cjavascript%E5%85%B1%E7%94%A8%E7%9A%84base64%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%BB%A3%E7%A0%81.html" title="python和javascript共用的base64加解密代码">python和javascript共用的base64加解密代码</a>
			</div>
			<div class="hot-time"><i class="icon-time"></i> 2015-08-15</div>
		</li>
	
	</ul>
</section>

<section class="widget" id="scroll">
	<h3><i class="icon-th-list"></i>文章目录</h3>
	<ul class="news-list">
	
	</ul>
</section>

</aside>

</div>
<footer class="footer">
	<div class="foot">
	<p>
		<i class="fa fa-copyright"></i> 2015 <a href="http://datochan.me/">DatoChan's Blog</a>. Theme designed by <a href="http://www.boke8.net/zblog-php-start.html" target="_blank">boke8.net</a> with <a href="https://github.com/mojombo/jekyll/" target="_blank">Jekyll</a> and <a href="http://fortawesome.github.com/Font-Awesome/" target="_blank">Font Awesome</a>.
	</p>
</div>
</footer>
<div class="backtop">
	<a title="反回顶部"><i class="icon-chevron-up"></i></a>
</div>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/responsiveslides.min.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/leonhere.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/jquery.lazyload.js"></script>
<script type="text/javascript" src="http://7xnsgl.com1.z0.glb.clouddn.com/public/js/prettify/prettify.js"></script>

<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"datochan"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
<!-- 多说公共JS代码 end -->

<script type="text/javascript">

$(document).ready(function(){
	$(".post .thumb img,.entry img").lazyload({
  	  	placeholder : "http://7xnsgl.com1.z0.glb.clouddn.com/public/images/grey.gif", 
  	 	effect      : "fadeIn"
	});

	$("#slider").responsiveSlides({
		auto: true,
		pager: true,
		nav: false,
		speed: 500,
		timeout: 5000,
		namespace: "centered-btns"
	});

	// 点击文章目录时让滚动条缓慢滚动
	$("#scroll").on("click", "a", function() {
	    $('html, body').animate({
	        scrollTop: $( $.attr(this, 'href') ).offset().top - 120
	    }, 500);
	    return false;
	});

	// 将目录移动到目录栏
	$("#scroll ul").html($("#markdown-toc").html());
	$("#markdown-toc").remove();

	// 启用代码高亮
    $("pre").addClass("prettyprint");
    prettyPrint();
});

</script>

</body>
</html>